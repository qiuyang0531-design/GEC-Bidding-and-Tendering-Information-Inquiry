# 更新日志

## v1.5.2 (2026-01-26)

### ✨ 新增功能

#### 网址编辑功能
- ✅ **编辑按钮**：在每个网址卡片上添加编辑按钮（铅笔图标）
- ✅ **编辑对话框**：点击编辑按钮打开对话框，可修改网址和备注名称
- ✅ **实时验证**：保存时验证URL格式，确保输入正确
- ✅ **错误提示**：显示详细的错误信息（如"该网址已存在"）
- ✅ **操作反馈**：保存成功后显示提示信息

### 🎨 UI优化

#### 操作按钮布局
- **原来**：只有删除按钮
- **现在**：编辑按钮 + 删除按钮
- **图标**：
  - 编辑：蓝色铅笔图标
  - 删除：红色垃圾桶图标
- **布局**：两个按钮并排显示，间距合理

#### 编辑对话框设计
- **标题**：编辑网址
- **描述**：修改网址信息，保存后将更新数据库中的记录
- **表单字段**：
  - 网址（必填）
  - 备注名称（可选）
- **按钮**：
  - 取消：灰色边框按钮
  - 保存：蓝色主按钮（带加载状态）

### 🔧 技术实现

#### API函数
```typescript
// src/db/api.ts
export async function updateUrl(
  urlId: string, 
  url: string, 
  name?: string
): Promise<Url> {
  const { data, error } = await supabase
    .from('urls')
    .update({ url, name: name || null })
    .eq('id', urlId)
    .select()
    .single();

  if (error) throw error;
  return data;
}
```

#### 状态管理
```typescript
// 编辑相关状态
const [editingUrl, setEditingUrl] = useState<Url | null>(null);
const [editDialogOpen, setEditDialogOpen] = useState(false);
const [editUrl, setEditUrl] = useState('');
const [editUrlName, setEditUrlName] = useState('');
const [editLoading, setEditLoading] = useState(false);
```

#### 编辑流程
1. **打开编辑**：点击编辑按钮 → 填充当前数据 → 打开对话框
2. **修改数据**：在对话框中修改网址和备注名称
3. **验证保存**：验证URL格式 → 调用updateUrl API → 更新列表
4. **关闭对话框**：保存成功或取消后关闭对话框

### 📊 使用场景

#### 场景1：修正错误的网址

**问题**：添加网址时输入错误
```
原网址：https://example.com/trde
正确网址：https://example.com/trade
```

**操作**：
1. 点击该网址的编辑按钮（铅笔图标）
2. 在对话框中修改网址为正确的URL
3. 点击"保存"按钮
4. 系统提示"网址更新成功"

---

#### 场景2：更新备注名称

**问题**：备注名称不够清晰
```
原备注：交易中心
新备注：北京绿色电力交易中心
```

**操作**：
1. 点击编辑按钮
2. 修改备注名称
3. 保存更新

---

#### 场景3：修正查询失败的网址

**问题**：网址查询失败，显示错误信息
```
❌ 上海交易中心
   https://shanghai.example.com/old-path
   ⚠️ 404 页面不存在
```

**操作**：
1. 查看错误信息（404 页面不存在）
2. 点击编辑按钮
3. 修改为正确的网址路径
4. 保存后重新执行查询

### 💡 功能优势

#### 便捷性
- **原来**：需要删除旧网址，重新添加新网址
- **现在**：直接编辑修改，保留历史数据

#### 数据完整性
- **原来**：删除网址会丢失相关的交易数据
- **现在**：编辑网址保留所有关联数据

#### 用户体验
- **原来**：操作繁琐，需要多个步骤
- **现在**：一键编辑，快速修正

### 🔄 操作流程

#### 完整编辑流程
```
1. 在"已添加的网址"列表中找到需要修改的网址
2. 点击该网址右侧的编辑按钮（蓝色铅笔图标）
3. 在弹出的对话框中修改信息：
   - 网址：修改URL地址
   - 备注名称：修改或添加备注
4. 点击"保存"按钮
5. 等待保存完成（按钮显示"保存中..."）
6. 看到"网址更新成功"提示
7. 对话框自动关闭，列表刷新显示新数据
```

#### 取消编辑
```
1. 打开编辑对话框
2. 点击"取消"按钮或对话框外部
3. 对话框关闭，不保存任何修改
```

### ⚠️ 验证规则

#### URL格式验证
- **必填**：网址不能为空
- **格式**：必须是有效的URL（包含http://或https://）
- **示例**：
  - ✅ https://example.com
  - ✅ http://example.com/path
  - ❌ example.com（缺少协议）
  - ❌ 空字符串

#### 唯一性验证
- **规则**：同一用户不能添加重复的网址
- **错误**：如果修改后的网址已存在，显示"该网址已存在"

### 🎯 实际应用

#### 常见修改场景

1. **URL路径变更**
   - 网站更新了URL结构
   - 需要修改路径部分

2. **域名变更**
   - 网站更换了域名
   - 需要修改域名部分

3. **协议变更**
   - 网站从HTTP升级到HTTPS
   - 需要修改协议部分

4. **备注优化**
   - 添加更详细的备注
   - 修正备注中的错别字

#### 错误修正流程

```
发现错误 → 查看错误信息 → 点击编辑 → 修正网址 → 保存 → 重新查询
```

### 📝 代码示例

#### 打开编辑对话框
```typescript
const handleEditUrl = (url: Url) => {
  setEditingUrl(url);
  setEditUrl(url.url);
  setEditUrlName(url.name || '');
  setEditDialogOpen(true);
  setError('');
  setSuccess('');
};
```

#### 保存编辑
```typescript
const handleSaveEdit = async () => {
  if (!editingUrl) return;

  setEditLoading(true);
  try {
    // 验证URL格式
    if (!editUrl.trim()) {
      setError('请输入网址');
      return;
    }
    
    new URL(editUrl); // 验证URL格式

    await updateUrl(editingUrl.id, editUrl, editUrlName || undefined);
    setSuccess('网址更新成功');
    setEditDialogOpen(false);
    await loadUrls();
    onUrlsChange?.();
  } catch (err: any) {
    if (err.message?.includes('duplicate')) {
      setError('该网址已存在');
    } else {
      setError('更新失败，请重试');
    }
  } finally {
    setEditLoading(false);
  }
};
```

### ✅ 验证结果

#### 代码质量
```bash
npm run lint
```
**结果**：✅ 通过（80个文件，无错误）

#### 功能测试
- ✅ 编辑按钮正确显示
- ✅ 对话框正常打开和关闭
- ✅ 数据正确填充到表单
- ✅ URL格式验证正常工作
- ✅ 保存后数据正确更新
- ✅ 错误提示正确显示
- ✅ 加载状态正常显示

### 🎨 视觉设计

#### 按钮样式
- **编辑按钮**：
  - 图标：Pencil（铅笔）
  - 颜色：text-primary（蓝色）
  - 大小：h-8 w-8
  - 变体：ghost

- **删除按钮**：
  - 图标：Trash2（垃圾桶）
  - 颜色：text-destructive（红色）
  - 大小：h-8 w-8
  - 变体：ghost

#### 对话框样式
- **宽度**：默认（适中）
- **标题**：编辑网址
- **描述**：灰色文字，说明操作
- **表单**：垂直布局，间距合理
- **按钮**：水平布局，右对齐

### 📚 相关组件

#### 新增组件
- `Dialog`：编辑对话框容器
- `DialogContent`：对话框内容
- `DialogHeader`：对话框头部
- `DialogTitle`：对话框标题
- `DialogDescription`：对话框描述
- `DialogFooter`：对话框底部按钮区

#### 新增图标
- `Pencil`：编辑图标

#### 修改文件
- `src/db/api.ts`：添加updateUrl函数
- `src/components/UrlManager.tsx`：添加编辑功能

### 🔄 数据流

#### 编辑数据流
```
用户点击编辑
  ↓
填充当前数据到表单
  ↓
用户修改数据
  ↓
点击保存
  ↓
验证数据格式
  ↓
调用updateUrl API
  ↓
更新数据库
  ↓
刷新列表
  ↓
显示成功提示
```

### 💡 最佳实践

#### 编辑前
- 确认需要修改的内容
- 准备好正确的网址

#### 编辑时
- 仔细检查URL格式
- 确保协议（http/https）正确
- 添加清晰的备注名称

#### 编辑后
- 查看"网址更新成功"提示
- 确认列表中的数据已更新
- 重新执行查询验证网址是否正确

---

## v1.5.1 (2026-01-26)

### ✨ 新增功能

#### 网址查询状态显示
- ✅ **状态图标**：在"已添加的网址"列表中显示每个网址的查询状态
  - 🟢 绿色勾选图标：查询成功
  - 🔴 红色错误图标：查询失败
  - ⚪ 灰色提示图标：未查询
- ✅ **错误信息显示**：查询失败的网址会显示具体的错误原因
- ✅ **视觉反馈**：
  - 查询成功：绿色背景边框
  - 查询失败：红色背景边框
  - 未查询：灰色背景
- ✅ **Tooltip提示**：鼠标悬停在状态图标上显示详细信息

### 🎨 UI优化

#### 网址列表增强
- **状态指示器**：每个网址左侧显示状态图标
- **错误提示**：失败的网址下方显示红色错误信息
- **颜色编码**：使用不同背景色区分状态
- **响应式设计**：保持良好的移动端适配

#### 错误消息改进
- **原来**："1个网址查询失败，请检查网址是否正确"
- **现在**："1个网址查询失败，请查看网址列表中的错误提示"
- **具体错误**：在网址列表中显示详细错误信息

### 🔧 技术实现

#### HomePage组件
- 添加`urlStatuses`状态管理
- 类型：`Record<string, { status: 'success' | 'error' | 'idle'; message?: string }>`
- 在查询过程中记录每个网址的状态和错误信息
- 将状态传递给UrlManager组件

#### UrlManager组件
- 接收`urlStatuses`属性
- 根据状态显示不同的图标和样式
- 使用Tooltip组件显示详细信息
- 使用cn工具函数动态设置样式类

#### 状态类型
```typescript
{
  [urlId: string]: {
    status: 'success' | 'error' | 'idle';
    message?: string; // 错误信息或成功信息
  }
}
```

### 📊 使用场景

#### 场景1：所有网址查询成功
```
已添加的网址
✅ 北京交易中心
   https://example1.com
   
✅ 上海交易中心
   https://example2.com
```

#### 场景2：部分网址查询失败
```
已添加的网址
✅ 北京交易中心
   https://example1.com
   
❌ 上海交易中心
   https://example2.com
   ⚠️ 网络请求失败: 连接超时
```

#### 场景3：未执行查询
```
已添加的网址
⚪ 北京交易中心
   https://example1.com
   
⚪ 上海交易中心
   https://example2.com
```

### 💡 用户体验提升

#### 问题定位
- **原来**：只知道有网址失败，不知道是哪个
- **现在**：一眼看出哪个网址有问题

#### 错误诊断
- **原来**：只知道"查询失败"
- **现在**：看到具体错误原因（如"连接超时"、"404未找到"等）

#### 操作指引
- **原来**：需要逐个测试网址
- **现在**：直接看到失败的网址，可以针对性修复

### 🎯 实际应用

#### 常见错误类型
1. **网络错误**
   - 连接超时
   - DNS解析失败
   - 网络不可达

2. **HTTP错误**
   - 404 页面不存在
   - 403 访问被拒绝
   - 500 服务器错误

3. **数据错误**
   - 页面结构不匹配
   - 数据格式错误
   - 缺少必需字段

#### 用户操作流程
1. 添加多个网址
2. 点击"执行查询"
3. 查看网址列表中的状态图标
4. 对于失败的网址：
   - 查看错误信息
   - 检查网址是否正确
   - 修正后重新查询

### 🔄 状态管理

#### 状态生命周期
1. **初始状态**：所有网址为`idle`（未查询）
2. **查询开始**：重置所有状态为空
3. **查询进行中**：逐个更新网址状态
4. **查询完成**：显示最终状态

#### 状态重置
- 每次点击"执行查询"时重置所有状态
- 确保显示的是最新的查询结果

### 📝 代码示例

#### 错误捕获
```typescript
try {
  await scrapeUrlData(url.id, url.url);
  newStatuses[url.id] = { status: 'success', message: '查询成功' };
} catch (err: any) {
  let errorMessage = '查询失败';
  if (err.message) {
    errorMessage = err.message;
  } else if (err.context) {
    errorMessage = `${err.context}: ${err.name || '未知错误'}`;
  }
  newStatuses[url.id] = { status: 'error', message: errorMessage };
}
```

#### 状态显示
```tsx
{status?.status === 'error' && status.message && (
  <p className="text-xs text-destructive mt-1">
    ⚠️ {status.message}
  </p>
)}
```

### ✅ 验证结果

#### 代码质量
```bash
npm run lint
```
**结果**：✅ 通过（80个文件，无错误）

#### 功能测试
- ✅ 状态图标正确显示
- ✅ 错误信息正确传递
- ✅ Tooltip提示正常工作
- ✅ 样式动态切换正常
- ✅ 响应式布局正常

### 🎨 视觉设计

#### 颜色方案
- **成功**：`bg-primary/10 border-primary/20` + 绿色图标
- **失败**：`bg-destructive/10 border-destructive/20` + 红色图标
- **未查询**：`bg-muted` + 灰色图标

#### 图标选择
- **CheckCircle2**：成功（绿色勾选）
- **XCircle**：失败（红色叉号）
- **AlertCircle**：未查询（灰色提示）

### 📚 相关组件

#### 新增依赖
- `Tooltip`：显示详细状态信息
- `CheckCircle2`, `XCircle`, `AlertCircle`：状态图标

#### 修改文件
- `src/pages/HomePage.tsx`：状态管理
- `src/components/UrlManager.tsx`：状态显示

---

## v1.5.0 (2026-01-26)

### ✨ 新增功能

#### 添加成交量字段
- ✅ **成交量字段**（quantity）：显示绿证交易的数量
- ✅ **位置**：在"总价"和"绿证单价"之间
- ✅ **格式**：数字 + "张"（如"100,000张"）
- ✅ **计算**：成交量 = 总价 / 绿证单价

### 📊 数据更新

#### 示例数据成交量
| 项目 | 总价 | 成交量 | 单价 | 验证 |
|------|------|--------|------|------|
| 2025年度风电绿证交易 | ¥700,000.00 | 97,222张 | ¥7.20 | ✅ |
| 光伏绿证采购项目（第一批） | ¥680,000.00 | 100,000张 | ¥6.80 | ✅ |
| 分布式光伏绿证交易项目 | ¥735,000.00 | 100,000张 | ¥7.35 | ✅ |
| 集中式风电绿证交易（第二批） | ¥658,000.00 | 100,000张 | ¥6.58 | ✅ |

### 🔧 技术改进

#### 数据库迁移
- 创建迁移：add_quantity_field
- 添加quantity字段（NUMERIC类型）
- 自动计算并填充示例数据的成交量
- 添加字段注释说明

#### 类型定义更新
- 更新Transaction接口：添加quantity字段
- 类型：number（可选）
- 注释：成交量（绿证数量）

#### UI组件优化
- TransactionTable组件：在总价和单价之间添加成交量列
- 添加formatQuantity函数：格式化显示（数字 + "张"）
- 表头更新：13列（原12列 + 成交量）

#### Edge Function优化
- 更新字段说明注释（12个字段 → 13个字段）
- 添加quantity字段的提取示例
- 更新console.log输出信息

### 📚 文档更新

#### 更新文档
- ✅ **TODO.md**
  - 更新数据字段说明（12个 → 13个）
  - 添加成交量字段的完成情况

- ✅ **CHANGELOG.md**
  - 记录v1.5.0版本更新内容

### ✅ 验证结果

#### 数据库验证
```sql
SELECT 
  project_name,
  total_price,
  quantity,
  unit_price,
  ROUND(total_price / quantity, 2) as 验证单价
FROM transactions;
```

**结果**：
- 所有项目的成交量计算正确
- 验证单价 = 总价 / 成交量 = 原单价 ✅

#### 代码质量验证
```bash
npm run lint
```
**结果**：✅ 通过（80个文件，无错误）

### 🎨 UI效果

#### 成交量显示
- **格式**：数字 + "张"
- **对齐**：右对齐（与总价、单价保持一致）
- **千分位**：使用千分位分隔符（如"100,000张"）
- **空值**：显示为"-"

#### 表格布局
- 原来12列 → 现在13列
- 列顺序：...总价 → **成交量** → 绿证单价...
- 保持良好的可读性

### 💡 业务价值

#### 更直观的数据展示
- 用户可以直接看到交易的绿证数量
- 不需要手动计算总价和单价的关系
- 便于快速了解交易规模

#### 数据完整性
- 成交量是绿证交易的重要指标
- 与总价、单价形成完整的价格体系
- 便于数据分析和统计

#### 实际应用场景
```
示例：光伏绿证采购项目（第一批）
- 总价：¥680,000.00
- 成交量：100,000张
- 单价：¥6.80
说明：采购了10万张绿证，总价68万元，平均每张6.8元
```

### 🔄 字段关系

#### 三个价格相关字段
1. **总价**（total_price）：交易的总金额
2. **成交量**（quantity）：交易的绿证数量
3. **绿证单价**（unit_price）：每张绿证的价格

#### 计算关系
```
总价 = 成交量 × 绿证单价
成交量 = 总价 / 绿证单价
绿证单价 = 总价 / 成交量
```

### 📝 数据抓取说明

#### 提取成交量
```typescript
// 方式1：直接提取
const quantity = parseFloat(extractField(rowHtml, 'quantity')) || null;

// 方式2：从总价和单价计算
const quantity = total_price && unit_price && unit_price > 0 
  ? Math.round(total_price / unit_price) 
  : null;
```

#### 注意事项
- 如果网站直接提供成交量，优先使用直接提取的值
- 如果没有成交量，可以从总价和单价计算
- 计算时注意除零错误
- 成交量通常是整数，使用Math.round()四舍五入

---

## v1.4.1 (2026-01-26)

### 🐛 Bug修复

#### 修复交易数据无法显示的问题
- **问题**：数据库迁移后，API查询仍使用旧的`transaction_date`字段，导致查询失败
- **错误信息**：`column transactions.transaction_date does not exist`
- **修复方案**：
  - 更新`getTransactions`函数，使用新的三个日期字段
  - 日期筛选：支持`award_date`（中标日期）和`bid_start_date`（招标开始日期）
  - 排序逻辑：优先按`award_date`降序，其次按`bid_start_date`降序
  - NULL值处理：使用`nullsFirst: false`确保有日期的记录优先显示

#### 技术细节
```typescript
// 修复前（错误）
query = query.gte('transaction_date', startDate);
query = query.lte('transaction_date', endDate);
query.order('transaction_date', { ascending: false });

// 修复后（正确）
query = query.or('award_date.gte.${startDate},bid_start_date.gte.${startDate}');
query.order('award_date', { ascending: false, nullsFirst: false })
     .order('bid_start_date', { ascending: false, nullsFirst: false });
```

### ✅ 验证结果
- 数据库包含4条示例数据（3条已中标，1条招标中）
- API查询成功返回所有数据
- 交易数据表格正常显示
- 代码质量检查通过

---

## v1.4.0 (2026-01-26)

### 🎯 新增功能

#### 日期字段拆分为三个独立字段
- ✅ **招标开始日期**（bid_start_date）：招标公告发布或开始接受投标的日期
- ✅ **招标结束日期**（bid_end_date）：招标截止日期
- ✅ **中标日期**（award_date）：公布中标结果的日期
- ✅ 更准确地区分招标信息和中标信息

### 📊 数据更新

#### 示例数据调整
- 为所有项目添加完整的日期信息
- 展示招标中和已中标两种状态

#### 当前示例数据分布
| 项目 | 招标开始 | 招标结束 | 中标日期 | 状态 |
|------|---------|---------|---------|------|
| 2025年度风电绿色电力证书交易项目 | 2025-11-01 | 2025-11-15 | 2025-11-20 | ✅ 已中标 |
| 光伏绿证采购项目（第一批） | 2024-12-10 | 2024-12-25 | 2025-01-05 | ✅ 已中标 |
| 分布式光伏绿证交易项目 | 2025-12-01 | 2025-12-10 | 2025-12-15 | ✅ 已中标 |
| 集中式风电绿证交易（第二批） | 2025-12-15 | 2025-12-30 | - | ⏳ 招标中 |

### 🔧 技术改进

#### 数据库迁移
- 创建迁移：split_transaction_date_to_three_dates
- 删除transaction_date字段
- 添加bid_start_date、bid_end_date、award_date三个字段
- 将现有数据迁移到award_date字段
- 添加字段注释说明

#### 类型定义更新
- 更新Transaction接口：删除transaction_date
- 添加bid_start_date、bid_end_date、award_date三个字段
- 所有日期字段都是可选的string类型

#### UI组件优化
- TransactionTable组件：将"交易日期"列改为三列
- 表头更新：招标开始日期、招标结束日期、中标日期
- 使用formatDate函数格式化显示

#### Edge Function优化
- 更新字段说明注释（10个字段 → 12个字段）
- 添加三个日期字段的提取示例
- 更新console.log输出信息

### 📚 文档更新

#### 更新文档
- ✅ **SCRAPING_GUIDE.md**
  - 更新数据字段表（transaction_date → 三个日期字段）
  - 添加日期处理函数说明
  - 添加三个日期字段的使用场景说明
  - 更新示例代码中的日期字段提取

- ✅ **QUICKSTART.md**
  - 更新所有示例数据，添加三个日期字段
  - 添加日期字段的详细说明
  - 展示招标中和已中标两种状态

- ✅ **TODO.md**
  - 更新数据字段说明（10个 → 12个）
  - 添加日期字段的完成情况
  - 更新重要说明部分

- ✅ **CHANGELOG.md**
  - 记录v1.4.0版本更新内容

### ✅ 验证结果

#### 数据库验证
```sql
SELECT 
  project_name,
  bid_start_date,
  bid_end_date,
  award_date,
  CASE 
    WHEN award_date IS NOT NULL THEN '已中标'
    ELSE '招标中'
  END as 状态
FROM transactions;
```

**结果**：
- 已中标：3条
- 招标中：1条
- 总计：4条

#### 代码质量验证
```bash
npm run lint
```
**结果**：✅ 通过（80个文件，无错误）

### 🎨 UI效果

#### 日期显示
- **招标开始日期**：格式化显示（如"2025/11/1"）
- **招标结束日期**：格式化显示（如"2025/11/15"）
- **中标日期**：格式化显示或"-"（招标中）

#### 表格布局
- 原来10列 → 现在12列
- 日期列宽度自适应
- 保持良好的可读性

### 📝 使用说明

#### 数据抓取时
```typescript
// 提取三个日期字段
const transaction = {
  // ... 其他字段
  bid_start_date: parseDate(extractField(html, 'bid_start')),
  bid_end_date: parseDate(extractField(html, 'bid_end')),
  award_date: parseDate(extractField(html, 'award')),
};
```

#### 数据展示时
- 应用会自动格式化日期显示
- 空值显示为"-"
- 用户可以清楚地看到招标和中标的时间线

### 🔄 兼容性

#### 向后兼容
- 数据库迁移自动处理
- 现有的transaction_date数据迁移到award_date
- UI自动适配新字段

#### 数据迁移
- 自动迁移：transaction_date → award_date
- 新字段：bid_start_date、bid_end_date初始为NULL
- 示例数据已更新完整日期信息

### 🎯 业务价值

#### 更准确的信息表示
- 区分招标信息和中标信息
- 清晰展示招标时间线
- 方便用户了解项目进度

#### 更灵活的数据查询
- 可以按招标开始日期筛选
- 可以按招标结束日期筛选
- 可以按中标日期筛选
- 可以查询招标中的项目（award_date为NULL）

#### 更完整的数据记录
- 如实记录招标和中标的完整时间信息
- 不丢失任何日期信息
- 便于后续分析和统计

### 💡 实际应用场景

#### 场景1：已中标项目
```
项目：2025年度风电绿证交易
招标开始：2025-11-01
招标结束：2025-11-15
中标日期：2025-11-20
说明：完整的招标和中标时间线
```

#### 场景2：招标中项目
```
项目：集中式风电绿证交易（第二批）
招标开始：2025-12-15
招标结束：2025-12-30
中标日期：-
说明：项目正在招标中，尚未公布中标结果
```

#### 场景3：跨年度招标
```
项目：光伏绿证采购项目（第一批）
招标开始：2024-12-10
招标结束：2024-12-25
中标日期：2025-01-05
说明：招标在2024年底，中标在2025年初
```

---

## v1.3.0 (2026-01-26)

### 🎯 新增功能

#### 绿证年份支持多年份格式
- ✅ **单年份**：如"2025"
- ✅ **多年份**：如"2024/2025"或"2024-2026"
- ✅ 数据库字段类型从INTEGER改为TEXT，支持更灵活的年份格式

### 📊 数据更新

#### 示例数据调整
- 更新2条示例数据为多年份格式
- 展示单年份和多年份的实际应用场景

#### 当前示例数据分布
| 项目 | 单价 | 通道类型 | 年份 |
|------|------|---------|------|
| 2025年度风电绿色电力证书交易项目 | 7.20元 | ✅ 通道 | 2025 |
| 光伏绿证采购项目（第一批） | 6.80元 | ➖ 未标注 | 2024/2025 |
| 分布式光伏绿证交易项目 | 7.35元 | ✅ 通道 | 2025 |
| 集中式风电绿证交易（第二批） | 6.58元 | ➖ 未标注 | 2025/2026 |

### 🔧 技术改进

#### 数据库迁移
- 创建迁移：change_cert_year_to_text
- 修改cert_year字段类型：INTEGER → TEXT
- 使用USING子句安全转换现有数据

#### 类型定义更新
- 更新Transaction接口：cert_year从number改为string
- 添加注释说明支持单年份和多年份格式

#### Edge Function优化
- 更新字段说明注释
- 添加年份提取示例代码
- 移除parseInt转换，直接使用文本格式

### 📚 文档更新

#### 更新文档
- ✅ **SCRAPING_GUIDE.md**
  - 更新cert_year字段类型说明（INTEGER → TEXT）
  - 添加extractYear函数示例
  - 支持多种年份格式的解析

- ✅ **QUICKSTART.md**
  - 更新示例数据说明
  - 添加多年份格式的示例
  - 完善重要说明部分

- ✅ **CHANGELOG.md**
  - 记录v1.3.0版本更新内容

### ✅ 验证结果

#### 数据库验证
```sql
SELECT 
  project_name,
  cert_year,
  CASE 
    WHEN cert_year LIKE '%/%' THEN '多年份'
    ELSE '单年份'
  END as 年份类型
FROM transactions;
```

**结果**：
- 单年份：2条
- 多年份：2条
- 总计：4条

#### 代码质量验证
```bash
npm run lint
```
**结果**：✅ 通过（80个文件，无错误）

### 🎨 UI效果

#### 年份显示
- **单年份**：直接显示"2025"
- **多年份**：显示"2024/2025"
- 无需特殊样式，文本显示即可

### 📝 使用说明

#### 数据抓取时
```typescript
// 使用extractYear函数处理年份
cert_year: extractYear(extractedText)

// 函数会返回：
// - "2025": 单年份
// - "2024/2025": 多年份（统一使用"/"分隔）
// - null: 无法提取年份
```

#### 数据展示时
- 应用会直接显示cert_year字段的文本值
- 单年份和多年份使用相同的显示方式
- 用户可以清楚地看到绿证涵盖的年份范围

### 🔄 兼容性

#### 向后兼容
- 数据库迁移使用USING子句安全转换
- 现有的整数年份自动转换为文本格式
- UI显示不受影响（原本就是文本显示）

#### 数据迁移
- 自动迁移：INTEGER值自动转换为TEXT
- 示例：2025 → "2025"
- 无需手动干预

### 🎯 业务价值

#### 更真实的数据表示
- 反映实际业务场景
- 有些绿证交易确实涵盖多个年份
- 如"2024/2025年度绿证"

#### 更灵活的数据存储
- 支持各种年份格式
- 单年份："2025"
- 多年份："2024/2025"
- 年份范围："2024-2026"

#### 更准确的信息记录
- 如实记录原始数据
- 不丢失年份信息
- 便于后续分析和统计

### 💡 实际应用场景

#### 场景1：单年份绿证
```
项目：2025年度风电绿证交易
绿证年份：2025
说明：该批绿证仅涵盖2025年
```

#### 场景2：跨年度绿证
```
项目：2024/2025年度光伏绿证采购
绿证年份：2024/2025
说明：该批绿证涵盖2024和2025两个年度
```

#### 场景3：多年度绿证
```
项目：2025-2026年度风电绿证交易
绿证年份：2025/2026
说明：该批绿证涵盖2025至2026年度
```

---

## v1.2.0 (2026-01-26)

### 🎯 新增功能

#### 通道类型三种状态支持
- ✅ **通道**（is_channel = true）：明确标注为通道交易，显示蓝色徽章
- ✅ **非通道**（is_channel = false）：明确标注为非通道交易，显示灰色徽章
- ✅ **未标注**（is_channel = null）：项目未标注通道类型，显示"-"

### 📊 数据更新

#### 示例数据调整
- 更新2条示例数据的通道类型为NULL（未标注）
- 保持2条示例数据的通道类型为true（通道）
- 展示通道类型的三种实际应用场景

#### 当前示例数据分布
| 项目 | 单价 | 通道类型 |
|------|------|---------|
| 2025年度风电绿色电力证书交易项目 | 7.20元 | ✅ 通道 |
| 光伏绿证采购项目（第一批） | 6.80元 | ➖ 未标注 |
| 分布式光伏绿证交易项目 | 7.35元 | ✅ 通道 |
| 集中式风电绿证交易（第二批） | 6.58元 | ➖ 未标注 |

### 🔧 技术改进

#### Edge Function优化
- 更新parseChannelType函数注释
- 添加通道类型解析辅助函数示例
- 完善字段说明文档

#### 代码优化
- TransactionTable组件已正确处理null值
- UI显示逻辑完善（null显示为"-"）
- 数据库字段支持NULL值

### 📚 文档更新

#### 新增文档
- ✅ **CHANNEL_TYPE_GUIDE.md**（5000+字）
  - 通道类型三种状态的详细说明
  - 数据库设计和UI显示
  - 数据抓取处理方法
  - 实际应用场景和最佳实践

#### 更新文档
- ✅ **SCRAPING_GUIDE.md**
  - 更新parseChannelType函数说明
  - 添加三种状态的处理示例
  - 完善通道类型解析逻辑

- ✅ **QUICKSTART.md**
  - 更新示例数据说明
  - 添加通道类型三种状态的说明
  - 调整示例数据的通道类型显示

- ✅ **DATA_CORRECTION.md**
  - 记录通道类型功能更新
  - 更新示例数据说明
  - 添加三种状态的实现方式

- ✅ **TODO.md**
  - 更新完成情况
  - 添加通道类型说明

- ✅ **README.md**
  - 添加CHANNEL_TYPE_GUIDE.md链接
  - 添加DATA_CORRECTION.md链接

### ✅ 验证结果

#### 数据库验证
```sql
SELECT 
  CASE 
    WHEN is_channel = true THEN '通道'
    WHEN is_channel = false THEN '非通道'
    WHEN is_channel IS NULL THEN '未标注'
  END as 通道类型,
  COUNT(*) as 数量
FROM transactions
GROUP BY is_channel;
```

**结果**：
- 通道：2条
- 未标注：2条
- 总计：4条

#### 代码质量验证
```bash
npm run lint
```
**结果**：✅ 通过（80个文件，无错误）

### 🎨 UI效果

#### 通道类型显示
- **通道**：蓝色徽章，文字"通道"
- **非通道**：灰色徽章，文字"非通道"
- **未标注**：普通文本"-"

#### 用户体验
- 清晰区分三种状态
- 视觉效果一致
- 符合用户预期

### 📝 使用说明

#### 数据抓取时
```typescript
// 使用parseChannelType函数处理通道类型
is_channel: parseChannelType(extractedText)

// 函数会返回：
// - true: 文本包含"通道"且不包含"非"
// - false: 文本包含"非通道"
// - null: 空值、"-"或其他情况
```

#### 数据展示时
- 应用会自动根据is_channel的值显示相应的UI
- null值显示为"-"，不会显示为空白
- 用户可以清楚地看到哪些项目未标注通道类型

### 🔄 兼容性

#### 向后兼容
- 现有数据不受影响
- 已有的true/false值继续正常显示
- 新增的null值支持不影响现有功能

#### 数据迁移
- 无需数据迁移
- 数据库字段本身就支持NULL
- 只是更新了部分示例数据

### 🎯 业务价值

#### 更真实的数据展示
- 反映实际业务场景
- 有些项目确实没有标注通道类型
- 避免强制填充不准确的数据

#### 更好的用户体验
- 用户可以清楚地看到数据的完整性
- "-"明确表示"未标注"，而不是"错误"或"缺失"
- 符合用户对真实数据的预期

#### 更灵活的数据处理
- 支持三种状态，适应不同的数据源
- 数据抓取时可以如实记录
- 数据分析时可以单独统计未标注的情况

---

## v1.1.0 (2026-01-26)

### 🔧 数据修正

#### 价格数据调整
- 绿证单价从125-150元调整为6.58-7.35元
- 符合2025年实际市场价格（约7元/张）
- 总价相应调整

#### 详情链接优化
- 示例数据的详情链接设为NULL
- UI显示"暂无链接"提示
- 添加说明文字

### 📚 文档新增
- ✅ SCRAPING_GUIDE.md（8000+字）
- ✅ DATA_CORRECTION.md
- ✅ DELIVERY.md

---

## v1.0.0 (2026-01-26)

### 🎉 初始版本

#### 核心功能
- ✅ 用户认证系统
- ✅ 网址管理功能
- ✅ 数据查询功能
- ✅ 数据展示功能
- ✅ 数据存储功能

#### 数据字段
- ✅ 10个交易信息字段完整实现
- ✅ 数据库结构完善
- ✅ RLS安全策略

#### 文档
- ✅ README.md
- ✅ QUICKSTART.md
- ✅ USAGE.md
- ✅ CHECKLIST.md
- ✅ TODO.md

---

**最后更新**：2026-01-26
**当前版本**：v1.2.0
